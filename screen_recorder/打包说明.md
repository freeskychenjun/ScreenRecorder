# 打包说明文档

## 打包信息

**打包工具**：PyInstaller 6.17.0
**Python版本**：3.14.0
**打包方式**：单文件可执行程序（--onefile）
**输出文件**：ScreenRecorder.exe
**文件大小**：85 MB

## 输出位置

```
D:\AICoding\ScreenRecorder\screen_recorder\dist\ScreenRecorder.exe
```

## 打包命令

### 方式1：使用 spec 文件（推荐）

```bash
cd screen_recorder
pyinstaller --clean "屏幕录制软件.spec"
```

### 方式2：直接命令

```bash
cd screen_recorder
pyinstaller --onefile --windowed --name ScreenRecorder main.py
```

## 打包内容

### 已包含的依赖

✅ **核心功能**
- PyQt5 (GUI框架)
- mss (屏幕捕获)
- OpenCV (视频编码)
- NumPy (数组处理)
- Pillow (图像处理)

✅ **音频功能**
- PyAudioWPatch (音频录制)
- wave (音频文件处理)
- threading (多线程)

✅ **工具库**
- json (配置管理)
- pathlib (路径处理)
- datetime (时间处理)
- subprocess (FFmpeg调用)

### 未包含的依赖

❌ **FFmpeg** (需要单独安装)
- EXE 不包含 FFmpeg
- 用户需自行安装才能使用音视频合并功能
- 安装方法：
  ```bash
  choco install ffmpeg
  # 或从 https://ffmpeg.org 下载
  ```

## 重新打包

### 修改代码后重新打包

1. 关闭正在运行的程序
2. 清理旧的构建文件：
   ```bash
   rmdir /s /q build dist
   ```
3. 重新打包：
   ```bash
   pyinstaller --clean "屏幕录制软件.spec"
   ```

### 修改打包配置

编辑 `屏幕录制软件.spec` 文件：

```python
hiddenimports=[
    # 添加新的隐藏导入
    '模块名称',
],
```

然后重新运行打包命令。

## 部署说明

### 系统要求

**最低要求**：
- Windows 10/11 (64位)
- 2 GB 可用内存
- 500 MB 可用磁盘空间

**推荐配置**：
- Windows 11
- 4 GB 内存
- SSD 硬盘
- 已安装 FFmpeg（音频功能需要）

### 分发方式

**单文件分发**：
- 直接分发 `ScreenRecorder.exe`
- 用户无需安装 Python
- 双击即可运行

**完整包分发**（推荐）：
```
ScreenRecorder/
├── ScreenRecorder.exe    # 主程序
├── README.txt            # 使用说明
├── 快速入门.md           # 快速指南
└── ffmpeg/               # 可选：包含 FFmpeg
    ├── ffmpeg.exe
    └── ffprobe.exe
```

### 用户安装说明

1. **下载程序**
   - 下载 `ScreenRecorder.exe`
   - 或解压完整包到任意目录

2. **安装 FFmpeg（可选但推荐）**
   ```bash
   # 使用 Chocolatey
   choco install ffmpeg

   # 或手动安装：
   # 1. 访问 https://www.gyan.dev/ffmpeg/builds/
   # 2. 下载 ffmpeg-release-essentials.zip
   # 3. 解压并添加到 PATH
   ```

3. **运行程序**
   - 双击 `ScreenRecorder.exe`
   - 首次运行可能需要几秒钟解压

4. **验证安装**
   - 检查音频功能是否可用
   - 尝试录制测试视频

## 已知问题

### 1. SmartScreen 警告

**问题**：首次运行显示 "Windows 已保护你的电脑"

**解决**：
- 点击"更多信息"
- 点击"仍要运行"
- 这是未签名程序的正常提示

### 2. 杀毒软件误报

**问题**：部分杀毒软件可能误报

**解决**：
- 添加到信任列表
- 或临时禁用杀毒软件安装

### 3. FFmpeg 未找到

**问题**：音频录制后无法合并音视频

**解决**：
- 安装 FFmpeg 并添加到 PATH
- 或将 ffmpeg.exe 放在与 ScreenRecorder.exe 同目录

### 4. 启动慢

**问题**：首次运行启动需要 5-10 秒

**原因**：
- 单文件需要解压到临时目录
- 包含大量依赖库

**优化**：
- 使用 SSD
- 或使用目录打包（--onedir）模式

## 性能优化

### 打包优化

**减小文件大小**：
```python
# 在 spec 文件中添加排除项
excludes=[
    'tkinter',        # 排除不需要的库
    'matplotlib',
    'pandas',
],
```

**加快启动速度**：
```bash
# 使用目录模式而非单文件
pyinstaller --onedir --windowed main.py
```

### 运行优化

- 将 EXE 放在 SSD 上
- 关闭实时扫描（杀毒软件）
- 确保足够的临时目录空间

## 开发调试

### 启用控制台（调试模式）

修改 spec 文件：
```python
exe = EXE(
    ...
    console=True,  # 显示控制台以查看错误信息
    ...
)
```

### 查看打包日志

日志位置：
```
build/屏幕录制软件/warn-屏幕录制软件.txt
```

### 常见错误

**ImportError**：
- 检查 hiddenimports 是否包含所有依赖
- 查看警告文件

**DLL 缺失**：
- 添加 binaries 参数到 spec 文件
- 确保所有 DLL 文件都被包含

**运行时错误**：
- 启用 console=True 查看详细错误
- 检查数据文件是否正确打包

## 版本管理

### 版本号格式

建议使用语义化版本号：
```
v主版本.次版本.修订版本

示例：v1.1.0
- 主版本：重大功能变更
- 次版本：新增功能
- 修订版本：Bug 修复
```

### 发布检查清单

- [ ] 更新版本号
- [ ] 测试所有功能
- [ ] 测试在不同 Windows 版本上的兼容性
- [ ] 更新文档
- [ ] 创建发布包
- [ ] 编写发布说明

## 许可与分发

MIT License

可以自由：
- ✅ 使用
- ✅ 修改
- ✅ 分发
- ✅ 商业使用

需要：
- ⚠️ 保留许可证声明
- ⚠️ 声明原始作者

---

**更新日期**：2025年2月10日
**文档版本**：1.1.0
